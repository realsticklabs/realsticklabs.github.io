<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Game Tech Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; }
        canvas { display: block; }
        #saveButton {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px 20px;
            background-color: #0078D7;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        #saveButton:hover {
            background-color: #005fa3;
        }
    </style>
</head>
<body>
    <button id="saveButton">Save Level</button>
    <script>
        // Setup scene, camera, renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Level dimensions
        const worldWidth = 25;
        const worldHeight = 20;
        const worldDepth = 25;
        const blockSize = 1;

        // Colors for blocks (1-7)
        const blockColors = [0xff0000, 0xff7f00, 0xffff00, 0x00ff00, 0x0000ff, 0x4b0082, 0xff1493];

        // Create grid of blocks
        const blocks = [];
        const cubeGeometry = new THREE.BoxGeometry(blockSize, blockSize, blockSize);

        for (let x = 0; x < worldWidth; x++) {
            for (let y = 0; y < worldHeight; y++) {
                for (let z = 0; z < worldDepth; z++) {
                    const cubeMaterial = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
                    const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
                    cube.position.set(
                        x * blockSize - (worldWidth * blockSize / 2),
                        y * blockSize,
                        z * blockSize - (worldDepth * blockSize / 2)
                    );
                    scene.add(cube);
                    blocks.push({ x, y, z, color: 0x00ff00 });
                }
            }
        }

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(50, 50, 50);
        scene.add(pointLight);

        // Camera controls
        const controls = { forward: false, backward: false, left: false, right: false };
        let currentBlockColor = 0xff0000; // Default to red (1)

        document.addEventListener('keydown', (event) => {
            if (event.key === 'w') controls.forward = true;
            if (event.key === 's') controls.backward = true;
            if (event.key === 'a') controls.left = true;
            if (event.key === 'd') controls.right = true;

            // Change block color with 1-7 keys
            const blockIndex = parseInt(event.key, 10) - 1;
            if (blockIndex >= 0 && blockIndex < blockColors.length) {
                currentBlockColor = blockColors[blockIndex];
            }
        });

        document.addEventListener('keyup', (event) => {
            if (event.key === 'w') controls.forward = false;
            if (event.key === 's') controls.backward = false;
            if (event.key === 'a') controls.left = false;
            if (event.key === 'd') controls.right = false;
        });

        // Save button functionality
        document.getElementById('saveButton').addEventListener('click', () => {
            const blockData = blocks.map(block => ({
                x: block.x,
                y: block.y,
                z: block.z,
                color: block.color.toString(16)
            }));
            const blob = new Blob([JSON.stringify(blockData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'block.dat';
            a.click();
            URL.revokeObjectURL(url);
        });

        // Camera movement speed
        const moveSpeed = 0.1;

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            if (controls.forward) camera.position.z -= moveSpeed;
            if (controls.backward) camera.position.z += moveSpeed;
            if (controls.left) camera.position.x -= moveSpeed;
            if (controls.right) camera.position.x += moveSpeed;

            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
